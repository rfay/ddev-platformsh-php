#ddev-generated
name: ddev-platformsh

#ddev_version_constraint: '>= v1.24.3'

project_files:
  - scripts/parse-platformsh-config.php
  - scripts/generate-ddev-config.php
  - scripts/generate-platform-relationships.php
  - scripts/setup-platformsh-configuration.php
  - web-build/Dockerfile.platformsh
  - homeadditions/.bashrc.d/platformsh-environment.sh

global_files:
  - commands/web/platform

pre_install_actions:
  - |
    <?php
    #ddev-description: Validate Platform.sh PHP application configuration
    
    // Use environment variables instead of complex validation
    $projectType = $_ENV['DDEV_PROJECT_TYPE'] ?? 'php';
    echo "DDEV Project Type: {$projectType}\n";
    
    // Test PHP YAML extension availability
    if (!extension_loaded('yaml')) {
        echo "❌ PHP YAML extension not available\n";
        exit(1);
    }
    echo "✅ PHP YAML extension is available\n";
    
    // Check for Platform.sh configuration (optional for templates)
    if (file_exists('../.platform.app.yaml')) {
        $platformApp = yaml_parse_file('../.platform.app.yaml');
        if ($platformApp && isset($platformApp['type'])) {
            echo "✅ Platform.sh configuration found: {$platformApp['type']}\n";
        }
    } else {
        echo "⚠️  No Platform.sh configuration found (template mode)\n";
    }
    ?>

post_install_actions:
  - |
    <?php
    #ddev-description: Setup Platform.sh configuration for DDEV
    require 'scripts/setup-platformsh-configuration.php';